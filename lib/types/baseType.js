"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _validator=_interopRequireDefault(require("../framework/validator"));var _ifConditionalSchema=_interopRequireDefault(require("../framework/ifConditionalSchema"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread();}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance");}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||Object.prototype.toString.call(iter)==="[object Arguments]")return Array.from(iter);}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}var BaseType=function(){function BaseType(){var _this=this;var type=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"any";var validators=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];_classCallCheck(this,BaseType);_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(this,"validate",function(value){return _this.runValidators(value);}),"runValidators",function(value){var isValid=true;_this.errors=[];_this.validators.forEach(function(v,index,arr){var result=v.validationMethod(value);if(!result){isValid=false;_this.errors.push(v.message(value));}});if(_this.conditional&&_this.conditional.if){var validatorsToRun=_this.conditional.evaluate(value)&&_this.conditional.then?_this.conditional.then:_this.conditional.else?_this.conditional.else:[];validatorsToRun.forEach(function(v,index,arr){var result=v.validationMethod(value);console.log(value);console.log(result);if(!result){isValid=false;_this.errors.push(v.message(value));}});}return isValid;}),"addValidator",function(validator){if(_this.conditional&&_this.conditional.currentCondition){_this.conditional.addConditionalValidator(validator);}else{_this.validators.push(validator);}return _this;}),"isIn",function(enumValues){return _this.addValidator(new _validator.default({message:function message(value){return"Expected ".concat(value," to be one of the following: ").concat(enumValues);},validationMethod:function validationMethod(value){return enumValues.includes(value);}}));}),"enum",function(enumValues){return _this.isIn(enumValues);}),"isConstant",function(constVal){return _this.addValidator(new _validator.default({message:function message(value){return"Expected ".concat(value," to be ").concat(constVal);},validationMethod:function validationMethod(value){return value===constVal;}}));}),"const",function(constVal){return _this.isConstant(constVal);}),"if",function(condition){_this.conditional=new _ifConditionalSchema.default(condition);return _this;});this.id=Symbol("id");this.validators=_toConsumableArray(validators);this.type=type;this.errors=[];this.currentcondition=null;this.conditional=null;}_createClass(BaseType,[{key:"then",get:function get(){if(this.conditional){this.conditional.currentCondition="then";this.conditional.then=[];}else{throw new Error("'If' must be called before '.else' can be used for validation.");}return this;}},{key:"else",get:function get(){if(this.conditional){this.conditional.currentCondition="else";this.conditional.else=[];}else{throw new Error("'If' must be called before '.else' can be used for validation.");}return this;}}]);return BaseType;}();exports.default=BaseType;